{% extends "base.html" %} {% block title %}Pelanggan - AZIDMart{% endblock %} {% block extra_css %}
<style>
  .users-container {
    background: #f5f7fa;
    min-height: calc(100vh - 76px);
    padding: 30px 0;
  }

  .user-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    border: none;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    height: 100%;
  }

  .user-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
    margin: 0 auto 20px;
  }

  .membership-badge {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .badge-gold {
    background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
    color: #333;
  }

  .badge-silver {
    background: linear-gradient(135deg, #c0c0c0 0%, #a9a9a9 100%);
    color: #333;
  }

  .badge-bronze {
    background: linear-gradient(135deg, #cd7f32 0%, #8b4513 100%);
    color: white;
  }

  .badge-regular {
    background: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
  }

  .user-stat {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    margin-top: 10px;
  }

  .stat-label {
    font-size: 0.8rem;
    color: #6c757d;
    text-transform: uppercase;
  }

  .stat-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: #1e3c72;
  }
</style>
{% endblock %} {% block content %}
<div class="users-container">
  <div class="container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-5">
      <div>
        <h1 class="h3 mb-2"><i class="bi bi-people text-primary me-2"></i>Data Pelanggan</h1>
        <p class="text-muted mb-0">Daftar pelanggan AZIDMart</p>
      </div>
      <div class="d-flex align-items-center">
        <span class="badge bg-primary me-3"> <i class="bi bi-person-fill me-1"></i>{{ users|length }} Pelanggan </span>
        <button class="btn btn-outline-primary"><i class="bi bi-download me-2"></i>Export</button>
      </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4 border-0 shadow-sm">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Filter Membership</label>
            <select class="form-select" id="membershipFilter">
              <option value="all">Semua Membership</option>
              <option value="gold">Gold Member</option>
              <option value="silver">Silver Member</option>
              <option value="bronze">Bronze Member</option>
              <option value="regular">Regular</option>
            </select>
          </div>
          <div class="col-md-5">
            <label class="form-label">Cari Pelanggan</label>
            <input type="text" class="form-control" id="searchUser" placeholder="Nama atau email..." />
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary w-100" id="applyFilter"><i class="bi bi-filter me-2"></i>Terapkan Filter</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Grid -->
    {% if users %}
    <div class="row" id="usersGrid">
      {% for user in users %}
      <div class="col-lg-4 col-md-6 mb-4 user-item" data-membership="{{ user.membership|lower }}" data-name="{{ user.name|lower }}" data-email="{{ user.email|lower }}">
        <div class="user-card">
          <!-- Avatar -->
          <div class="user-avatar">{{ user.name.split(' ')|map('first')|join|upper }}</div>

          <!-- User Info -->
          <div class="text-center mb-3">
            <h5 class="mb-1">{{ user.name }}</h5>
            <p class="text-muted mb-2"><i class="bi bi-envelope me-1"></i>{{ user.email }}</p>

            <!-- Membership Badge -->
            {% if 'gold' in user.membership|lower %}
            <span class="membership-badge badge-gold">‚≠ê {{ user.membership }}</span>
            {% elif 'silver' in user.membership|lower %}
            <span class="membership-badge badge-silver">ü•à {{ user.membership }}</span>
            {% elif 'bronze' in user.membership|lower %}
            <span class="membership-badge badge-bronze">ü•â {{ user.membership }}</span>
            {% else %}
            <span class="membership-badge badge-regular">{{ user.membership }}</span>
            {% endif %}
          </div>

          <!-- Stats -->
          <div class="row g-2">
            <div class="col-6">
              <div class="user-stat">
                <div class="stat-label">Total Pembelian</div>
                <div class="stat-value">{{ user.total_purchases|default(0) }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="user-stat">
                <div class="stat-label">Total Belanja</div>
                <div class="stat-value">Rp {{ user.total_spent|default(0)|int|format_currency }}</div>
              </div>
            </div>
          </div>

          <!-- Contact -->
          <div class="mt-3 pt-3 border-top text-center">
            <small class="text-muted">
              <i class="bi bi-telephone me-1"></i>
              {{ user.phone|default('08xx-xxxx-xxxx') }}
            </small>
          </div>

          <!-- Actions -->
          <div class="mt-3">
            <button class="btn btn-outline-primary btn-sm w-100"><i class="bi bi-eye me-1"></i>Lihat Detail</button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Empty State -->
    {% else %}
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="bi bi-people" style="font-size: 4rem; color: #dee2e6"></i>
      </div>
      <h3 class="mb-3">Belum Ada Data Pelanggan</h3>
      <p class="text-muted mb-4">Data pelanggan akan muncul di sini ketika tersedia.</p>
      <a href="/" class="btn btn-primary"> <i class="bi bi-arrow-left me-2"></i>Kembali ke Dashboard </a>
    </div>
    {% endif %}

    <!-- Summary -->
    {% if users %}
    <div class="card border-0 shadow-sm mt-4">
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-3">
            <h4 class="text-primary mb-1">{{ users|selectattr('membership', 'equalto', 'Gold Member')|list|length }}</h4>
            <p class="text-muted mb-0">Gold Members</p>
          </div>
          <div class="col-md-3">
            <h4 class="text-secondary mb-1">{{ users|selectattr('membership', 'equalto', 'Silver Member')|list|length }}</h4>
            <p class="text-muted mb-0">Silver Members</p>
          </div>
          <div class="col-md-3">
            <h4 class="text-warning mb-1">{{ users|selectattr('membership', 'equalto', 'Bronze Member')|list|length }}</h4>
            <p class="text-muted mb-0">Bronze Members</p>
          </div>
          <div class="col-md-3">
            <h4 class="text-success mb-1">{{ users|selectattr('membership', 'equalto', 'Regular')|list|length }}</h4>
            <p class="text-muted mb-0">Regular Customers</p>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const membershipFilter = document.getElementById('membershipFilter');
    const searchInput = document.getElementById('searchUser');
    const applyFilter = document.getElementById('applyFilter');
    const userItems = document.querySelectorAll('.user-item');

    // Filter function
    function filterUsers() {
      const membershipValue = membershipFilter.value;
      const searchValue = searchInput.value.toLowerCase();

      userItems.forEach((item) => {
        const membership = item.getAttribute('data-membership');
        const name = item.getAttribute('data-name');
        const email = item.getAttribute('data-email');

        let show = true;

        // Filter by membership
        if (membershipValue !== 'all' && !membership.includes(membershipValue)) {
          show = false;
        }

        // Filter by search
        if (searchValue && !name.includes(searchValue) && !email.includes(searchValue)) {
          show = false;
        }

        // Show/hide item
        if (show) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Event listeners
    applyFilter.addEventListener('click', filterUsers);
    searchInput.addEventListener('keyup', function (e) {
      if (e.key === 'Enter') {
        filterUsers();
      }
    });

    // Initial filter (in case of page refresh with params)
    filterUsers();

    // Add animation to cards
    userItems.forEach((item, index) => {
      item.style.opacity = '0';
      item.style.transform = 'translateY(20px)';

      setTimeout(() => {
        item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
      }, index * 100);
    });
  });
</script>
{% endblock %}